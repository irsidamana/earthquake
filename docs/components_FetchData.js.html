<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/FetchData.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/FetchData.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import Map from './Map.js';
import Table from './Table.js';
import ErrorBoundary from './ErrorBoundary.js';
import CanvasJSReact from '../assets/canvasjs.react';
import '../styles/Styles.css';

import Header from './Header.js';

var CanvasJSChart = CanvasJSReact.CanvasJSChart;
const HOUR_1 = 60 * 60 * 1000;

const EARTHQUAKES_API = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0';

var intervals = [];

/**
 * A class for fetching the information from the API url
 * and creating a chart that shows the number of earthquakesin the world
 * during each 1-hour interval for the last 24 hours.
 */
export default class FetchData extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      loading: true,
      earthquakes: [],
      totalCount: 0
    };
  }

  async componentDidMount() {
    const url = `${EARTHQUAKES_API}/summary/all_day.geojsonp`;

    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    else {
      const data = await response.text();
      var data_json = JSON.parse(data.substring(16, data.length - 2));
      const values = Object.values(data_json.features);

      this.setState({
        loading: false,
        earthquakes: values.map(earthquake => ({
          id: earthquake.id,
          type: earthquake.properties.type,
          mag: earthquake.properties.mag,
          sig: earthquake.properties.sig,
          alert: earthquake.properties.alert,
          status: earthquake.properties.status,
          place: earthquake.properties.place,
          time: new Date(earthquake.properties.time).toString(),
          coordinates: earthquake.geometry.coordinates,
          ids: earthquake.properties.ids
        })),
        totalCount: 0
      });

      for( let i = 0; i &lt; 24; i++){
        var time_temp = {x: new Date((new Date()) - (i+1)*HOUR_1), y: 0};
        intervals.push(time_temp);
      }

      for(let i = 0; i &lt;values.length; i++) {
        var temp = new Date(values[i].properties.time);
        for(let j=0; j&lt;intervals.length; j++) {
          if(temp> intervals[j].x){
            intervals[j].y++;
            break;
          }
        }
      }

  		this.chart.render();
    }


  }

  render() {
    const options = {
      theme: "light2",
      axisY: {
        title: "Number of Earthquakes"
      },
      data: [{
        type: "line",
        xValueFormatString: "DD MMM YYYY, HH:MM:ss",
        yValueFormatString: "#0 earthquakes",
        dataPoints: intervals
      }],
      backgroundColor: 'rgb(190, 199, 180)'

    };
    if (this.state.loading) {
      return &lt;div> loading... &lt; /div>;
    }
    return (
      &lt;ErrorBoundary>
        &lt;Header number={this.state.earthquakes.length}/>

        &lt;div className="Color1">
          &lt;Map coordinates = {this.state.earthquakes}/>
        &lt;/div>
        &lt;div className="Color2 Padding">
          &lt;div className="ChartDiv">
          &lt;h2 className="Chart"> Number of earthquakes worldwide every hour&lt;/h2>
            &lt;CanvasJSChart options = {options} onRef={ref => this.chart = ref}/>
          &lt;/div>
        &lt;/div>
        &lt;div className="Color3 Padding">
          &lt;Table data = {this.state.earthquakes}/>
        &lt;/div>
      &lt;/ErrorBoundary>
    );
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="module.exports.html">exports</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Aug 19 2020 13:59:48 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
